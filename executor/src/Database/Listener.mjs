// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Tilia from "tilia/src/Tilia.mjs";
import PgPromise from "pg-promise";
import * as PgListener from "pg-listener";

let pgp = PgPromise();

let db = pgp(process.env.DB_URL);

let listener = new PgListener.PgListener({
  pgp: pgp,
  db: db
});

let store = Tilia.tilia({
  listeners: new Set()
});

let Store = {
  store: store
};

function withListener(premise_id, onMessage) {
  let listeners = store.listeners;
  console.log(listeners);
  if (listeners.has(premise_id) === false) {
    console.log("Listening on " + premise_id);
    listener.listen([premise_id], {
      onMessage: onMessage
    });
  } else {
    listeners.add(premise_id);
  }
}

export {
  pgp,
  db,
  listener,
  Store,
  withListener,
}
/* pgp Not a pure module */
