(melange.emit
 (runtime_deps ui/index.html ui/src/style.css ui/src/tailwind.css)
 (package executor)
 (promote (until-clean))
 (target lib)
 (libraries executor ui common)
 (module_systems
  (es6 mjs))
 (preprocess
  (pps melange.ppx)))

(rule
 (targets public/.post_build)
 (deps
  (source_tree lib)
  build.js)
 (action
  (progn
   (system "mkdir -p public")
   (system "bun build.js")
   (with-stdout-to public/.post_build
    (system "date +%s")))))

(alias
 (name default)
 (deps public/.post_build))

(dirs common executor ui \ node_modules)
