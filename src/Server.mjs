// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Premise from "./Database/Premise.mjs";
import * as MockData from "./MockData/MockData.mjs";
import * as Inventory from "./Database/Inventory.mjs";
import * as Connection from "./Database/Connection.mjs";
import * as Primitive_option from "@rescript/runtime/lib/es6/Primitive_option.js";

let get = async (_req, param) => new Response(Bun.file("./public/index.html"));

let handler_GET = get;

let handler = {
  GET: handler_GET
};

let Frontend = {
  html_placeholder: `<!--app-html-->`,
  get: get,
  handler: handler
};

let get$1 = async (req, param) => {
  let headers = new Headers();
  headers.set("content-type", "application/json");
  let response = await Connection.withClient(async client => {
    let premise_id = req.params["premise_id"];
    let premise = await Premise.getPremise(client, premise_id);
    let inventory = await Inventory.getInventoryList(client, premise_id);
    return {
      inventory: inventory,
      premise: premise
    };
  });
  return Response.json(response, {
    status: 200,
    headers: Primitive_option.some(headers)
  });
};

let handler_GET$1 = get$1;

let handler$1 = {
  GET: handler_GET$1
};

let Config = {
  get: get$1,
  handler: handler$1
};

let post = async (req, param) => {
  let premise_id = req.params["premise_id"];
  await Connection.withClient(async client => await MockData.createMockData(client, premise_id));
  return new Response("");
};

let handler_POST = post;

let handler$2 = {
  POST: handler_POST
};

let Inventory$1 = {
  post: post,
  handler: handler$2
};

let Route = {
  Frontend: Frontend,
  Config: Config,
  Inventory: Inventory$1
};

let server = Bun.serve({
  port: 8899,
  fetch: async (req, param) => {
    let url = new URL(req.url).pathname;
    let filePath = `./public/` + url;
    return new Response(Bun.file(filePath));
  },
  routes: Object.fromEntries([
    [
      "/",
      handler
    ],
    [
      "/config/:premise_id",
      handler$1
    ],
    [
      "/inventory/:premise_id",
      handler$2
    ]
  ])
});

let port = server.port.toString();

let hostName = server.hostname;

console.log(`Server listening on http://` + hostName + `:` + port + `!`);

export {
  Route,
  server,
  port,
  hostName,
}
/* server Not a pure module */
